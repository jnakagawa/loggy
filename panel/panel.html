<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Logger</title>
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <img src="../loggy.png" alt="Loggy Logo" class="header-logo">
        <h1>Analytics Logger</h1>
      </div>
      <div class="header-actions">
        <button id="pauseBtn" class="btn btn-secondary" title="Pause event collection">
          ‚è∏Ô∏è Pause
        </button>
        <button id="refreshBtn" class="btn btn-secondary" title="Refresh events">
          üîÑ
        </button>
        <button id="settingsBtn" class="btn btn-secondary" title="Settings">
          ‚öôÔ∏è
        </button>
      </div>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat">
        <span class="stat-label">Total Events:</span>
        <span class="stat-value" id="totalEvents">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">Filtered:</span>
        <span class="stat-value" id="filteredEvents">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">Storage:</span>
        <span class="stat-value" id="storageUsage">0%</span>
      </div>
      <div class="stat proxy-stat">
        <span class="stat-label">Proxy:</span>
        <span class="stat-value" id="proxyStatusMain">Checking...</span>
        <button id="proxyActionBtn" class="btn btn-primary btn-small">Start</button>
        <span class="info-icon" title="Enable the proxy to capture events from other Chrome extensions.">i</span>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <input
        type="text"
        id="searchInput"
        class="search-input"
        placeholder="Search events, properties, URLs..."
      >
      <select id="parserFilter" class="filter-select">
        <option value="">All Sources</option>
        <option value="segment-batch">Segment Batch</option>
        <option value="segment-track">Segment Track</option>
        <option value="google-analytics-4">Google Analytics 4</option>
        <option value="google-analytics-ua">Google Analytics UA</option>
        <option value="graphql">GraphQL</option>
        <option value="generic-json">Custom JSON</option>
      </select>
      <select id="eventTypeFilter" class="filter-select">
        <option value="">All Events</option>
      </select>
      <button id="clearFiltersBtn" class="btn btn-secondary btn-small">Clear Filters</button>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
      <button id="clearBtn" class="btn btn-danger btn-small">Clear All</button>
      <button id="exportJSONBtn" class="btn btn-primary btn-small">Export JSON</button>
      <button id="exportCSVBtn" class="btn btn-primary btn-small">Export CSV</button>
    </div>

    <!-- Events List -->
    <div class="events-container">
      <div id="emptyState" class="empty-state">
        <div class="empty-icon">üì≠</div>
        <h2>No events captured yet</h2>
        <p>Analytics events will appear here automatically as your extensions send them.</p>
        <p class="empty-hint">Try using an extension that sends analytics events (e.g., Segment, Google Analytics).</p>
      </div>
      <div id="eventsList" class="events-list"></div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button id="closeSettingsBtn" class="btn-close">‚úï</button>
        </div>

        <!-- Settings Tabs -->
        <div class="modal-tabs">
          <button class="tab-btn active" data-tab="general">General</button>
          <button class="tab-btn" data-tab="sources">Sources</button>
        </div>

        <div class="modal-body">
          <!-- General Settings Tab -->
          <div id="generalTab" class="tab-content active">
          <div class="setting-group">
            <label class="setting-label">
              <input type="checkbox" id="enabledSetting">
              <span>Enable Event Capture</span>
            </label>
          </div>

          <div class="setting-group">
            <label class="setting-label">
              <input type="checkbox" id="persistSetting">
              <span>Persist Events (save to storage)</span>
            </label>
          </div>

          <div class="setting-group">
            <label class="setting-label">
              Max Events (Ring Buffer Size):
            </label>
            <input type="number" id="maxEventsSetting" min="100" max="10000" step="100" value="1000">
          </div>

          <div class="setting-group">
            <h3>Capture Sources</h3>
            <label class="setting-label">
              <input type="checkbox" id="captureSegmentSetting">
              <span>Segment Analytics</span>
            </label>
            <label class="setting-label">
              <input type="checkbox" id="captureGASetting">
              <span>Google Analytics</span>
            </label>
            <label class="setting-label">
              <input type="checkbox" id="captureGraphQLSetting">
              <span>GraphQL</span>
            </label>
            <label class="setting-label">
              <input type="checkbox" id="captureCustomSetting">
              <span>Custom JSON</span>
            </label>
          </div>
          </div><!-- End General Tab -->

          <!-- Sources Tab -->
          <div id="sourcesTab" class="tab-content">
            <div class="sources-header">
              <h3>Analytics Sources</h3>
              <div style="display: flex; gap: 8px;">
                <button id="addSourceBtn" class="btn btn-primary btn-small">+ Add Source</button>
                <button id="importSourcesBtn" class="btn btn-secondary btn-small">Import</button>
                <button id="exportSourcesBtn" class="btn btn-secondary btn-small">Export</button>
              </div>
            </div>

            <div id="sourcesList" class="sources-list">
              <!-- Sources will be populated here -->
            </div>
          </div><!-- End Sources Tab -->

        </div><!-- End modal-body -->
        <div class="modal-footer">
          <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
          <button id="cancelSettingsBtn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Source Editor Modal -->
  <div id="sourceEditorModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="sourceEditorTitle">Edit Source</h2>
        <button id="closeSourceEditorBtn" class="btn-close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label class="setting-label">Name</label>
          <input type="text" id="sourceName" placeholder="e.g., Reddit, My App">
        </div>

        <div class="setting-group" style="display: flex; gap: 12px;">
          <div style="flex: 1;">
            <label class="setting-label">Icon</label>
            <input type="text" id="sourceIcon" placeholder="üìä" maxlength="2">
          </div>
          <div style="flex: 1;">
            <label class="setting-label">Color</label>
            <input type="color" id="sourceColor" value="#6366F1">
          </div>
        </div>

        <div class="setting-group">
          <label class="setting-label">
            <input type="checkbox" id="sourceEnabled" checked>
            <span>Enabled</span>
          </label>
        </div>

        <div class="setting-group">
          <label class="setting-label">URL Patterns</label>
          <div id="urlPatternsList" class="patterns-list">
            <!-- Patterns will be added here -->
          </div>
          <button id="addPatternBtn" class="btn btn-secondary btn-small">+ Add Pattern</button>
        </div>

        <div class="setting-group">
          <label class="setting-label">Parser</label>
          <select id="sourceParser">
            <option value="generic">Generic (auto-detect fields)</option>
            <option value="segment">Segment</option>
            <option value="reddit">Reddit</option>
            <option value="google-analytics">Google Analytics</option>
            <option value="graphql">GraphQL</option>
          </select>
        </div>

        <div class="setting-group">
          <label class="setting-label">Field Mappings (comma-separated, tried in order)</label>
          <div style="display: grid; gap: 8px;">
            <div>
              <label style="font-size: 12px; color: #666;">Event Name:</label>
              <input type="text" id="fieldEventName" placeholder="event, eventName, action, type">
            </div>
            <div>
              <label style="font-size: 12px; color: #666;">Timestamp:</label>
              <input type="text" id="fieldTimestamp" placeholder="timestamp, time, ts, client_timestamp">
            </div>
            <div>
              <label style="font-size: 12px; color: #666;">User ID:</label>
              <input type="text" id="fieldUserId" placeholder="user_id, userId, uid">
            </div>
          </div>
        </div>

        <div class="setting-group" id="sourceStats" style="display: none;">
          <label class="setting-label">Statistics</label>
          <div style="font-size: 13px; color: #666;">
            <div>Events Captured: <span id="statsEventsCapture">0</span></div>
            <div>Last Captured: <span id="statsLastCaptured">Never</span></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="deleteSourceBtn" class="btn btn-danger" style="margin-right: auto;">Delete</button>
        <button id="testSourceBtn" class="btn btn-secondary">Test Pattern</button>
        <button id="saveSourceBtn" class="btn btn-primary">Save</button>
        <button id="cancelSourceBtn" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirmModal" class="modal" style="display: none;">
    <div class="modal-content confirm-modal-content">
      <div class="modal-header">
        <h2 id="confirmTitle">Confirm</h2>
      </div>
      <div class="modal-body">
        <p id="confirmMessage">Are you sure?</p>
        <label class="setting-label" id="confirmDontAskLabel" style="margin-top: 16px;">
          <input type="checkbox" id="confirmDontAsk">
          <span>Don't ask me again</span>
        </label>
      </div>
      <div class="modal-footer">
        <button id="confirmCancelBtn" class="btn btn-secondary">Cancel</button>
        <button id="confirmOkBtn" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>

  <script type="module" src="panel.js"></script>
</body>
</html>
